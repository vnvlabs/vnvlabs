
ARG VERSION=latest
ARG REPO=ghcr.io/vnvlabs

FROM ${REPO}/asgard:${VERSION} as asgard

FROM ${REPO}/heat:${VERSION} as heat

FROM ${REPO}/mfem:${VERSION} as mfem 

FROM ${REPO}/miniamr:${VERSION} as miniamr

FROM ${REPO}/simple:${VERSION} as simple

FROM ${REPO}/swfft:${VERSION} as swfft

FROM ${REPO}/xs_bench:${VERSION} as xsbench

# Moose has vnv-hypre-petsc-libmesh-moose all installed already. 
FROM ${REPO}/moose:${VERSION} as moose

COPY --from=asgard ${SOURCE_DIR}/asgard ${SOURCE_DIR}/asgard
ENV VNV_CONFIG=${VNV_CONFIG}:${SOURCE_DIR}/asgard/build/vnv.__registration__

COPY --from=heat ${SOURCE_DIR}/heat ${SOURCE_DIR}/heat
ENV VNV_CONFIG=${VNV_CONFIG}:${SOURCE_DIR}/heat/build/vnv.__registration__

COPY --from=mfem ${SOURCE_DIR}/mfem ${SOURCE_DIR}/mfem
COPY --from=mfem ${SOFTWARE_DIR}/mfem ${SOFTWARE_DIR}/mfem
ENV VNV_CONFIG=${VNV_CONFIG}:${SOURCE_DIR}/mfem/docker_build/vnv.__registration__

COPY --from=miniamr ${SOURCE_DIR}/miniAMR ${SOURCE_DIR}/miniAMR
ENV VNV_CONFIG=${VNV_CONFIG}:${SOURCE_DIR}/swfft/build/vnv.__registration__

COPY --from=simple ${SOURCE_DIR}/simple ${SOURCE_DIR}/simple
ENV VNV_CONFIG=${VNV_CONFIG}:${SOURCE_DIR}/simple/build/vnv.__registration__

COPY --from=swfft ${SOURCE_DIR}/swfft ${SOURCE_DIR}/swfft
ENV VNV_CONFIG=${VNV_CONFIG}:${SOURCE_DIR}/swfft/build/vnv.__registration__

COPY --from=xsbench ${SOURCE_DIR}/xs-bench ${SOURCE_DIR}/xs-bench
ENV VNV_CONFIG=${VNV_CONFIG}:${SOURCE_DIR}/xs-bench/vnv.__registration__

COPY all_config /config
ENV VNV_CONFIG=${VNV_CONFIG}:/config/vnv.__registration__
